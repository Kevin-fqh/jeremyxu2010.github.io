<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>开发小技巧备忘 - jeremy的技术点滴</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Jeremy Xu" />
  <meta name="description" content="今天一段时间一直在忙工作上的事，并没有系统地学习研究某一个具体的问题，但回顾这一个月的工作，发现还是有一些经验可以记录一下的。但这些经验没法" />




<meta name="google-site-verification" content="Ol4gI1XKZ2qsa-efwwJvaGeDyXb91RL-pZBv-3uyY-A" />


<meta name="generator" content="Hugo " />


<link rel="canonical" href="https://jeremyxu2010.github.io/2017/04/%E5%BC%80%E5%8F%91%E5%B0%8F%E6%8A%80%E5%B7%A7%E5%A4%87%E5%BF%98/" />

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">







<link href="/dist/even.min.css?v=3.1.1" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">



<link rel="stylesheet" href="/css/mathjax.css">


<meta property="og:title" content="开发小技巧备忘" />
<meta property="og:description" content="今天一段时间一直在忙工作上的事，并没有系统地学习研究某一个具体的问题，但回顾这一个月的工作，发现还是有一些经验可以记录一下的。但这些经验没法" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jeremyxu2010.github.io/2017/04/%E5%BC%80%E5%8F%91%E5%B0%8F%E6%8A%80%E5%B7%A7%E5%A4%87%E5%BF%98/" />
<meta property="article:published_time" content="2017-04-24T20:00:00+08:00" />
<meta property="article:modified_time" content="2017-04-24T20:00:00+08:00" />
<meta itemprop="name" content="开发小技巧备忘">
<meta itemprop="description" content="今天一段时间一直在忙工作上的事，并没有系统地学习研究某一个具体的问题，但回顾这一个月的工作，发现还是有一些经验可以记录一下的。但这些经验没法">
<meta itemprop="datePublished" content="2017-04-24T20:00:00&#43;08:00" />
<meta itemprop="dateModified" content="2017-04-24T20:00:00&#43;08:00" />
<meta itemprop="wordCount" content="1668">



<meta itemprop="keywords" content="java,python," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="开发小技巧备忘"/>
<meta name="twitter:description" content="今天一段时间一直在忙工作上的事，并没有系统地学习研究某一个具体的问题，但回顾这一个月的工作，发现还是有一些经验可以记录一下的。但这些经验没法"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">jeremy的技术点滴</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/search/">
        <li class="mobile-menu-item">Search</li>
      </a>
  </ul>
</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">jeremy的技术点滴</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/search/">Search</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">开发小技巧备忘</h1>

      <div class="post-meta">
        <span class="post-time"> 2017-04-24 </span>
        <div class="post-category">
            
              <a href="/categories/%E5%B7%A5%E4%BD%9C%E6%9D%82%E8%AE%B0/"> 工作杂记 </a>
            
          </div>
        <span class="more-meta"> 约 1668 字 </span>
        <span class="more-meta"> 预计阅读 4 分钟 </span>
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#httpclient">杂项一：httpclient典型用法</a></li>
    <li><a href="#jdk6jdk7">杂项二：jdk6升级jdk7改造</a></li>
    <li><a href="#python">杂项三：简易的python程序分发</a></li>
    <li><a href="#topn">杂项四：统计一组数据中的出现次数最多的topN数据</a></li>
    <li><a href="#pythonexcel">杂项五：python操作excel文件</a></li>
    <li><a href="#pythonmysql">杂项六：python里操作mysql数据库</a></li>
    <li><a href="#python-1">杂项七：python里计算两个字符串的相似度</a></li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p>今天一段时间一直在忙工作上的事，并没有系统地学习研究某一个具体的问题，但回顾这一个月的工作，发现还是有一些经验可以记录一下的。但这些经验没法系统地整理起来，因此只能算是开发中的杂项了。</p>
<h2 id="httpclient">杂项一：httpclient典型用法</h2>
<ol>
<li>基础用法
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">HttpClient httpClient <span style="color:#f92672">=</span> HttpClientBuilder<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
HttpPost postMethod <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
    postMethod <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HttpPost<span style="color:#f92672">(</span>reqUrl<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    postMethod<span style="color:#f92672">.</span><span style="color:#a6e22e">setConfig</span><span style="color:#f92672">(</span>RequestConfig<span style="color:#f92672">.</span><span style="color:#a6e22e">custom</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setConnectTimeout</span><span style="color:#f92672">(</span>2000<span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setSocketTimeout</span><span style="color:#f92672">(</span>5000<span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> params <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    params<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;param1&#34;</span><span style="color:#f92672">,</span> param1<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    params<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;param2&#34;</span><span style="color:#f92672">,</span> param2<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    postMethod<span style="color:#f92672">.</span><span style="color:#a6e22e">setEntity</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> StringEntity<span style="color:#f92672">(</span>JSON<span style="color:#f92672">.</span><span style="color:#a6e22e">json</span><span style="color:#f92672">(</span>params<span style="color:#f92672">)</span><span style="color:#f92672">,</span> ContentType<span style="color:#f92672">.</span><span style="color:#a6e22e">APPLICATION_JSON</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    HttpResponse response <span style="color:#f92672">=</span> httpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">execute</span><span style="color:#f92672">(</span>postMethod<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>response<span style="color:#f92672">.</span><span style="color:#a6e22e">getStatusLine</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getStatusCode</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span> 200<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        HttpEntity resEntity <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span><span style="color:#a6e22e">getEntity</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        JSONObject parsedJsonObj <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>JSONObject<span style="color:#f92672">)</span> JSON<span style="color:#f92672">.</span><span style="color:#a6e22e">parse</span><span style="color:#f92672">(</span>EntityUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span>resEntity<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;UTF-8&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>

        <span style="color:#75715e">//process parsedJsonObj
</span><span style="color:#75715e"></span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>resEntity <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
                EntityUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">consume</span><span style="color:#f92672">(</span>resEntity<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception ignore<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    logger<span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;请求失败&#34;</span><span style="color:#f92672">,</span> e<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
     <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>postMethod <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
         postMethod<span style="color:#f92672">.</span><span style="color:#a6e22e">releaseConnection</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
     <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>上面这段代码还是太麻烦了，实际编码中可以将上述代码封装成函数，只需要传入<code>reqUrl</code>,<code>params</code>, <code>JsonResponseProcessHandler</code>就可以了。</p>
</li>
<li>拼接请求url
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">List<span style="color:#f92672">&lt;</span>NameValuePair<span style="color:#f92672">&gt;</span> params <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;</span>NameValuePair<span style="color:#f92672">&gt;</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
params<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> BasicNameValuePair<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;param1&#34;</span><span style="color:#f92672">,</span> param1<span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
params<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> BasicNameValuePair<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;param2&#34;</span><span style="color:#f92672">,</span> param2<span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
URIBuilder uriBuilder <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> URIBuilder<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;http://exmaple.com&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setPath</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/req_path&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">addParameters</span><span style="color:#f92672">(</span>params<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
HttpPost postMethod <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HttpPost<span style="color:#f92672">(</span>uriBuilder<span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
</code></pre></div></li>
<li>流式续传文件
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">RandomAccessFile raf <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RandomAccessFile<span style="color:#f92672">(</span>file<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;r&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
InputStream fileIn <span style="color:#f92672">=</span> Channels<span style="color:#f92672">.</span><span style="color:#a6e22e">newInputStream</span><span style="color:#f92672">(</span>raf<span style="color:#f92672">.</span><span style="color:#a6e22e">getChannel</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">position</span><span style="color:#f92672">(</span>offset<span style="color:#f92672">)</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
InputStreamEntity reqEntity <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> InputStreamEntity<span style="color:#f92672">(</span>fileIn<span style="color:#f92672">,</span> fileSize <span style="color:#f92672">-</span> offset<span style="color:#f92672">,</span> ContentType
        <span style="color:#f92672">.</span><span style="color:#a6e22e">APPLICATION_OCTET_STREAM</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
postMethod<span style="color:#f92672">.</span><span style="color:#a6e22e">setEntity</span><span style="color:#f92672">(</span>reqEntity<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
HttpResponse response <span style="color:#f92672">=</span> httpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">execute</span><span style="color:#f92672">(</span>postMethod<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
</code></pre></div></li>
<li>定制httpclient的连接管理器
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">PoolingHttpClientConnectionManager connectionManager <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> PoolingHttpClientConnectionManager<span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#75715e">// 每个主机最大的连接数(如果会大量向同一主机发送大量http请求，需加大此值)
</span><span style="color:#75715e"></span>connectionManager<span style="color:#f92672">.</span><span style="color:#a6e22e">setDefaultMaxPerRoute</span><span style="color:#f92672">(</span>10<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#75715e">// 总共最大的连接数
</span><span style="color:#75715e"></span>connectionManager<span style="color:#f92672">.</span><span style="color:#a6e22e">setMaxTotal</span><span style="color:#f92672">(</span>100<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
httpClient <span style="color:#f92672">=</span> HttpClientBuilder<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">setConnectionManager</span><span style="color:#f92672">(</span>connectionManager<span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
</code></pre></div></li>
</ol>
<h2 id="jdk6jdk7">杂项二：jdk6升级jdk7改造</h2>
<ol>
<li>
<p>jpeg编码代码改造</p>
<p><code>jdk6下的代码</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">JPEGImageEncoder encoder <span style="color:#f92672">=</span> JPEGCodec<span style="color:#f92672">.</span><span style="color:#a6e22e">createJPEGEncoder</span><span style="color:#f92672">(</span>out<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
JPEGEncodeParam param <span style="color:#f92672">=</span> encoder<span style="color:#f92672">.</span><span style="color:#a6e22e">getDefaultJPEGEncodeParam</span><span style="color:#f92672">(</span>bufferedImage<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
param<span style="color:#f92672">.</span><span style="color:#a6e22e">setQuality</span><span style="color:#f92672">(</span>quality<span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
encoder<span style="color:#f92672">.</span><span style="color:#a6e22e">setJPEGEncodeParam</span><span style="color:#f92672">(</span>param<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
encoder<span style="color:#f92672">.</span><span style="color:#a6e22e">encode</span><span style="color:#f92672">(</span>bufferedImage<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
</code></pre></div><p><code>jdk7下的代码</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">ImageWriter imageWriter <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>ImageWriter<span style="color:#f92672">)</span>ImageIO<span style="color:#f92672">.</span><span style="color:#a6e22e">getImageWritersBySuffix</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;jpeg&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
ImageOutputStream ios <span style="color:#f92672">=</span> ImageIO<span style="color:#f92672">.</span><span style="color:#a6e22e">createImageOutputStream</span><span style="color:#f92672">(</span>out<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
imageWriter<span style="color:#f92672">.</span><span style="color:#a6e22e">setOutput</span><span style="color:#f92672">(</span>ios<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
JPEGImageWriteParam jpegParams  <span style="color:#f92672">=</span>  <span style="color:#f92672">(</span>JPEGImageWriteParam<span style="color:#f92672">)</span> imageWriter<span style="color:#f92672">.</span><span style="color:#a6e22e">getDefaultWriteParam</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
jpegParams<span style="color:#f92672">.</span><span style="color:#a6e22e">setCompressionMode</span><span style="color:#f92672">(</span>JPEGImageWriteParam<span style="color:#f92672">.</span><span style="color:#a6e22e">MODE_EXPLICIT</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
jpegParams<span style="color:#f92672">.</span><span style="color:#a6e22e">setCompressionQuality</span><span style="color:#f92672">(</span>quality<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
IIOMetadata imageMetaData <span style="color:#f92672">=</span> imageWriter<span style="color:#f92672">.</span><span style="color:#a6e22e">getDefaultImageMetadata</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ImageTypeSpecifier<span style="color:#f92672">(</span>bufferedImage<span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
imageWriter<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>imageMetaData<span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> IIOImage<span style="color:#f92672">(</span>bufferedImage<span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
</code></pre></div></li>
<li>
<p>自定义DataSource代码改造</p>
<p><code>jdk6下的代码</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomDataSource</span> <span style="color:#66d9ef">extends</span> AbstractRoutingDataSource <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">determineCurrentLookupKey</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><code>jdk7下的代码</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomDataSource</span> <span style="color:#66d9ef">extends</span> AbstractRoutingDataSource <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">determineCurrentLookupKey</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#f92672">.</span><span style="color:#f92672">.</span><span style="color:#f92672">.</span>
    <span style="color:#f92672">}</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> Logger <span style="color:#a6e22e">getParentLogger</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> SQLFeatureNotSupportedException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> java<span style="color:#f92672">.</span><span style="color:#a6e22e">sql</span><span style="color:#f92672">.</span><span style="color:#a6e22e">SQLFeatureNotSupportedException</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;getParentLogger not supported&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
<li>
<p>pom升级</p>
<p>pom中加入代码编译级别的配置</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;plugin</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;groupId</span><span style="color:#f92672">&gt;</span>org.apache.maven.plugins<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId</span><span style="color:#f92672">&gt;</span>maven-compiler-plugin<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;version</span><span style="color:#f92672">&gt;</span>2.3.2<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;configuration</span><span style="color:#f92672">&gt;</span>
      <span style="color:#f92672">&lt;source</span><span style="color:#f92672">&gt;</span>1.7<span style="color:#f92672">&lt;/source&gt;</span>
      <span style="color:#f92672">&lt;target</span><span style="color:#f92672">&gt;</span>1.7<span style="color:#f92672">&lt;/target&gt;</span>
    <span style="color:#f92672">&lt;/configuration&gt;</span>
<span style="color:#f92672">&lt;/plugin&gt;</span>
</code></pre></div></li>
</ol>
<h2 id="python">杂项三：简易的python程序分发</h2>
<p>工作中使用python写了一部分与NLP相关的代码，但主程序是部署在Tomcat里的java程序，于是需要想办法分发python程序，同时完成java程序与python程序的交互。</p>
<ol>
<li>自带python程序的依赖库
python程序依赖于一些第三方python库，但很难让运维提前使用<code>pip</code>安装第三方python库，研究了下，可以采用以下简易方法。
<ol>
<li>在目录下新建一个<code>libs</code>目录，将<code>jieba</code>, <code>snownlp</code>等第三方库放到<code>libs</code>目录下。</li>
<li>修改python程序入口，在最开始加入以下代码。
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> sys
<span style="color:#f92672">import</span> os
sys<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>append(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>dirname(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>realpath(__file__)), <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">libs</span><span style="color:#e6db74">&#39;</span>))
</code></pre></div></li>
</ol>
</li>
<li>python程序作为简单的http伺服
为了方便java与python交互，将python程序包装为http伺服，以供java程序交互，这里没有用任何其它第三方http框架。
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> threading
<span style="color:#f92672">from</span> BaseHTTPServer <span style="color:#f92672">import</span> BaseHTTPRequestHandler, HTTPServer
<span style="color:#f92672">import</span> urlparse

server <span style="color:#f92672">=</span> None

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">stop_server</span>():
    <span style="color:#66d9ef">global</span> server
    <span style="color:#66d9ef">if</span> server <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
        server<span style="color:#f92672">.</span>shutdown()

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomRequestHandler</span>(BaseHTTPRequestHandler):

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">do_GET</span>(self):
        <span style="color:#75715e"># GET请求访问http://127.0.0.1:8333/?op=stop即可停止http伺服器</span>
        params <span style="color:#f92672">=</span> urlparse<span style="color:#f92672">.</span>parse_qs(urlparse<span style="color:#f92672">.</span>urlparse(self<span style="color:#f92672">.</span>path)<span style="color:#f92672">.</span>query)
        <span style="color:#66d9ef">if</span> params<span style="color:#f92672">.</span>has_key(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">op</span><span style="color:#e6db74">&#39;</span>) <span style="color:#f92672">and</span> params[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">op</span><span style="color:#e6db74">&#39;</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">stop</span><span style="color:#e6db74">&#39;</span>:
            thread <span style="color:#f92672">=</span> threading<span style="color:#f92672">.</span>Thread(None, stop_server)
            thread<span style="color:#f92672">.</span>start()
        <span style="color:#66d9ef">else</span>:
            self<span style="color:#f92672">.</span>send_response(<span style="color:#ae81ff">200</span>)
            self<span style="color:#f92672">.</span>send_header(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Content-type</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">text/html</span><span style="color:#e6db74">&#39;</span>)
            self<span style="color:#f92672">.</span>end_headers()
            self<span style="color:#f92672">.</span>wfile<span style="color:#f92672">.</span>write(<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It Works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><span style="color:#e6db74">&#34;</span>)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">do_POST</span>(self):
        content_length <span style="color:#f92672">=</span> int(self<span style="color:#f92672">.</span>headers[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Content-Length</span><span style="color:#e6db74">&#39;</span>])
        post_data <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>rfile<span style="color:#f92672">.</span>read(content_length)
        <span style="color:#75715e"># process post data</span>
        self<span style="color:#f92672">.</span>send_response(<span style="color:#ae81ff">200</span>)
        self<span style="color:#f92672">.</span>send_header(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">Content-type</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">text/plain</span><span style="color:#e6db74">&#39;</span>)
        self<span style="color:#f92672">.</span>end_headers()
        self<span style="color:#f92672">.</span>wfile<span style="color:#f92672">.</span>write(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span><span style="color:#f92672">.</span>join(respLines))

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">log_message</span>(self, format, <span style="color:#f92672">*</span>args):
        <span style="color:#66d9ef">pass</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">run</span>(server_class<span style="color:#f92672">=</span>HTTPServer, handler_class<span style="color:#f92672">=</span>CustomRequestHandler, port<span style="color:#f92672">=</span><span style="color:#ae81ff">8333</span>):
    <span style="color:#66d9ef">global</span> httpd
    server_address <span style="color:#f92672">=</span> (<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">&#39;</span>, port)
    server <span style="color:#f92672">=</span> server_class(server_address, handler_class)
    server<span style="color:#f92672">.</span>serve_forever()

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">__main__</span><span style="color:#e6db74">&#39;</span>:
    <span style="color:#f92672">from</span> sys <span style="color:#f92672">import</span> argv

    <span style="color:#66d9ef">if</span> len(argv) <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>:
        run(port<span style="color:#f92672">=</span>int(argv[<span style="color:#ae81ff">1</span>]))
    <span style="color:#66d9ef">else</span>:
        run()
</code></pre></div></li>
<li>java程序里启动与停止python伺服
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">startPythonService</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    CommandUtil<span style="color:#f92672">.</span><span style="color:#a6e22e">executeCommand</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> String<span style="color:#f92672">[</span><span style="color:#f92672">]</span><span style="color:#f92672">{</span><span style="color:#e6db74">&#34;python&#34;</span><span style="color:#f92672">,</span> PYTHON_SCRIPT_PATH<span style="color:#f92672">,</span> String<span style="color:#f92672">.</span><span style="color:#a6e22e">valueOf</span><span style="color:#f92672">(</span>SERVER_PORT<span style="color:#f92672">)</span><span style="color:#f92672">}</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">stopPythonService</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    HttpGet getMethod <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        getMethod <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HttpGet<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;http://127.0.0.1:&#34;</span> <span style="color:#f92672">+</span> SERVER_PORT <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;/?op=stop&#34;</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        HttpResponse response <span style="color:#f92672">=</span> httpClient<span style="color:#f92672">.</span><span style="color:#a6e22e">execute</span><span style="color:#f92672">(</span>getMethod<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Exception e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        logger<span style="color:#f92672">.</span><span style="color:#a6e22e">debug</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;停止python服务的状态失败&#34;</span><span style="color:#f92672">,</span>e<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span><span style="color:#f92672">(</span>getMethod <span style="color:#f92672">!</span><span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            getMethod<span style="color:#f92672">.</span><span style="color:#a6e22e">releaseConnection</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
</ol>
<h2 id="topn">杂项四：统计一组数据中的出现次数最多的topN数据</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Multiset<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> nameCounter <span style="color:#f92672">=</span> HashMultiset<span style="color:#f92672">.</span><span style="color:#a6e22e">create</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#66d9ef">for</span><span style="color:#f92672">(</span>String name <span style="color:#f92672">:</span> names<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    nameCounter<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>name<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
Iterable<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> top5Names <span style="color:#f92672">=</span> Iterables<span style="color:#f92672">.</span><span style="color:#a6e22e">limit</span><span style="color:#f92672">(</span>Multisets<span style="color:#f92672">.</span><span style="color:#a6e22e">copyHighestCountFirst</span><span style="color:#f92672">(</span>nameCounter<span style="color:#f92672">)</span><span style="color:#f92672">.</span><span style="color:#a6e22e">asList</span><span style="color:#f92672">(</span><span style="color:#f92672">)</span><span style="color:#f92672">,</span> 5<span style="color:#f92672">)</span><span style="color:#f92672">;</span>
</code></pre></div><h2 id="pythonexcel">杂项五：python操作excel文件</h2>
<ol>
<li>从文件加载excel文件
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e"># 加载xlsx文件</span>
workbook <span style="color:#f92672">=</span> openpyxl<span style="color:#f92672">.</span>load_workbook(xlsx_file_path)
<span style="color:#75715e"># 获取活跃的sheet</span>
sheet <span style="color:#f92672">=</span> workbook<span style="color:#f92672">.</span>active
<span style="color:#75715e"># 获取所有的sheet名称</span>
sheet_names <span style="color:#f92672">=</span> sheet<span style="color:#f92672">.</span>get_sheet_names()
<span style="color:#75715e"># 获取最二个sheet</span>
another_sheet <span style="color:#f92672">=</span> workbook[sheet_names[<span style="color:#ae81ff">1</span>]]
<span style="color:#75715e"># 修改sheet的名称</span>
another_sheet<span style="color:#f92672">.</span>title <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">AnotherSheet</span><span style="color:#e6db74">&#39;</span>
<span style="color:#75715e"># 获取最大的行数</span>
row_count <span style="color:#f92672">=</span> sheet<span style="color:#f92672">.</span>max_row
<span style="color:#75715e"># 获取最大的列数</span>
column_count <span style="color:#f92672">=</span> sheet<span style="color:#f92672">.</span>max_column
</code></pre></div></li>
<li>遍历数据
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">101</span>):
    <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">101</span>):
        <span style="color:#66d9ef">print</span>(ws<span style="color:#f92672">.</span>cell(row<span style="color:#f92672">=</span>i, column<span style="color:#f92672">=</span>j)<span style="color:#f92672">.</span>value)

<span style="color:#66d9ef">for</span> row <span style="color:#f92672">in</span> ws<span style="color:#f92672">.</span>iter_rows(min_row<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>, max_col<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, max_row<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>):
    <span style="color:#66d9ef">for</span> cell <span style="color:#f92672">in</span> row:
        <span style="color:#66d9ef">print</span>(cell<span style="color:#f92672">.</span>value)
</code></pre></div></li>
<li>访问单元格的数据
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#设置单元格数据</span>
sheet<span style="color:#f92672">.</span>cell(row<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, column<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>, value<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">xdfdf</span><span style="color:#e6db74">&#39;</span>)
sheet[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">C2</span><span style="color:#e6db74">&#39;</span>]<span style="color:#f92672">.</span>value <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">xdfdf</span><span style="color:#e6db74">&#39;</span>
<span style="color:#75715e">#获取单元格数据</span>
cell_value <span style="color:#f92672">=</span> sheet<span style="color:#f92672">.</span>cell(row<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, column<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>)<span style="color:#f92672">.</span>value
cell_value <span style="color:#f92672">=</span> sheet[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">C2</span><span style="color:#e6db74">&#39;</span>]<span style="color:#f92672">.</span>value
</code></pre></div></li>
<li>写入文件
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">workbook<span style="color:#f92672">.</span>save(xlsx_save_path)
</code></pre></div></li>
<li>修改单元格的字段
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">cell<span style="color:#f92672">.</span>font <span style="color:#f92672">=</span> openpyxl<span style="color:#f92672">.</span>styles<span style="color:#f92672">.</span>Font(bold <span style="color:#f92672">=</span> True)
</code></pre></div></li>
</ol>
<p>还有一些更高级的用法参见<code>https://openpyxl.readthedocs.io/en/default/</code></p>
<h2 id="pythonmysql">杂项六：python里操作mysql数据库</h2>
<p>写了一个工具操作mysql数据库的工具方法如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">sql_query_generator</span>(sql):
    <span style="color:#66d9ef">try</span>:
        conn <span style="color:#f92672">=</span> pymysql<span style="color:#f92672">.</span>connect(host<span style="color:#f92672">=</span>DB_IP, user<span style="color:#f92672">=</span>DB_USER, password<span style="color:#f92672">=</span>DB_PASSWD, \
                               db<span style="color:#f92672">=</span>DB_NAME, charset<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">utf8</span><span style="color:#e6db74">&#39;</span>, cursorclass<span style="color:#f92672">=</span>pymysql<span style="color:#f92672">.</span>cursors<span style="color:#f92672">.</span>DictCursor)
        <span style="color:#66d9ef">with</span> conn<span style="color:#f92672">.</span>cursor() <span style="color:#66d9ef">as</span> cursor:
            cursor<span style="color:#f92672">.</span>execute(sql)
            <span style="color:#66d9ef">for</span> row <span style="color:#f92672">in</span> cursor:
                <span style="color:#66d9ef">yield</span> row
    <span style="color:#66d9ef">finally</span>:
        conn<span style="color:#f92672">.</span>close()
</code></pre></div><p>使用起来也比较简单：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">query_generator <span style="color:#f92672">=</span> sql_query_generator(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">select * from user;</span><span style="color:#e6db74">&#39;</span>)

<span style="color:#66d9ef">for</span> user <span style="color:#f92672">in</span> query_generator:
    <span style="color:#66d9ef">print</span>(user)
</code></pre></div><h2 id="python-1">杂项七：python里计算两个字符串的相似度</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> difflib
<span style="color:#66d9ef">print</span>(difflib<span style="color:#f92672">.</span>SequenceMatcher(None, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">hello world</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">hello</span><span style="color:#e6db74">&#39;</span>)<span style="color:#f92672">.</span>ratio())
<span style="color:#75715e"># 也可以用Levenshtein</span>
<span style="color:#f92672">import</span> Levenshtein
<span style="color:#66d9ef">print</span>(Levenshtein<span style="color:#f92672">.</span>ratio(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">hello world</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">hello</span><span style="color:#e6db74">&#39;</span>))
</code></pre></div>
    </div>

    
    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Jeremy Xu</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">2017-04-24</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content">&copy; Copyright 2020 Jeremy Xu</span>
  </p>
</div>

    
    
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">赞赏支持</label>
  <div class="qr-code">
    
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="/wechat-qr-code.png">
        <span>微信打赏</span>
      </label>
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="/alipay-qr-code.png">
        <span>支付宝打赏</span>
      </label>
  </div>
</div>

    <footer class="post-footer">
      <div class="post-tags">
          
          <a href="/tags/java/">java</a>
          
          <a href="/tags/python/">python</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/2017/05/%E4%BD%BF%E7%94%A8keras%E7%A0%B4%E8%A7%A3%E9%AA%8C%E8%AF%81%E7%A0%81/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">使用keras破解验证码</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/2017/03/%E7%BC%96%E5%86%99mybatis-generator%E6%8F%92%E4%BB%B6/">
            <span class="next-text nav-default">编写mybatis-generator插件</span>
            <span class="prev-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        


<div id="utter-container"></div>
<script src="https://utteranc.es/client.js" repo='jeremyxu2010/blog_comment'
  issue-term="title" theme='github-light' crossorigin="anonymous" async>
  </script>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:jeremyxu2010@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://plus.google.com/u/0/103057094241630654183" class="iconfont icon-google" title="google"></a>
      <a href="https://github.com/jeremyxu2010" class="iconfont icon-github" title="github"></a>
  <a href="https://jeremyxu2010.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    
      2016 - 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">&copy; Copyright 2019 Jeremy Xu</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
<script type="text/javascript" src="/dist/even.min.js?v=3.1.1"></script>
  <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$'], ['\[\[','\]\]']],
      processEscapes: true,
      processEnvironments: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      TeX: { equationNumbers: { autoNumber: "AMS" },
           extensions: ["AMSmath.js", "AMSsymbols.js"] }
    }
  });
  
  MathJax.Hub.Queue(function() {
      
      
      
      var all = MathJax.Hub.getAllJax(), i;
      for(i = 0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
  </script>








<script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.0/fuse.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js"></script>
<script src="https://jeremyxu2010.github.io/js/search.js"></script>


</body>
</html>
